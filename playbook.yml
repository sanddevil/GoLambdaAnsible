---

- hosts: all
  become: true
  environment:
    PATH: "{{ ansible_env.PATH }}:{{ go_bin_path }}"

  vars_files:
    - config.yml
  
  roles:

    # Golang
    - role: andrewrothstein.go

    # VMs are naturally unsafe places...
    - role: geerlingguy.firewall

    # Linux Tree command
    - role: nephelaiio.tree

    # Environmental variables
    - role: weareinteractive.environment

    # NodeJS
    - role: geerlingguy.nodejs
      nodejs_npm_global_packages:
        - name: serverless

  tasks: 
    - name: set timezone to default value
      timezone:
        name: "{{ user_timezone }}"

    - name: Add another bin dir to system-wide $PATH.
      copy:
        dest: /etc/profile.d/custom-path.sh
        content: 'PATH=$PATH:{{ go_bin_path }}'

    - name: Install go dep
      shell: curl -s https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
      args:
        creates: "{{ user_timezone }}/dep"

    - name: Set permissions on /GoLambda - change this dir if you've changed the sync dir in Vagrantfile
      file:
        path: /GoLambda
        owner: vagrant
        group: vagrant
        mode: u=rwx,g=rx,o=rx
